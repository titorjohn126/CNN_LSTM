# CNN+LSTM地铁车门亚健康状态标签分类预测


### **项目概述**

本项目的目标是通过 CNN+LSTM 模型对地铁车门传感器采集的时间序列数据进行分类预测。数据集包含多个实验的传感器数据，每次实验分为开门和关门两个阶段，记录了电压、电流、速度等特征信息。项目通过卷积神经网络（CNN）提取局部特征，再利用长短期记忆网络（LSTM）捕捉时间序列中的长依赖关系，最终实现对标签的分类。

### **数据存储结构**

数据按照 k 折交叉验证 被分为 5 个折，存储在 processed_data 目录下。每个折的数据集都包含训练集（train）和测试集（test），且每个数据集根据标签类别进行了组织存储。结构如下：
(k折交叉验证的代码我没写在这，写在Transformer项目里了)
|-- processed_data/
    |-- experiment_split_fold_1/
        |-- train/
            |-- label_14/
                |-- opening/      # 开门实验数据
                |-- closing/      # 关门实验数据
            |-- label_15/
                ...
        |-- test/
            |-- label_14/
                |-- opening/
                |-- closing/
            |-- label_15/
                ...
    |-- experiment_split_fold_2/
    |-- experiment_split_fold_3/
    |-- experiment_split_fold_4/
    |-- experiment_split_fold_5/

### **数据结构**

每个实验的数据以 CSV 文件 存储，为一次实验的开门和关门数据，包含多种传感器的数据，每一行表示某个时间点的传感器读数，列数据如下：

collect_time：数据采集时间。
Voltage：电压。
current：电流。
Antipinchforce：防夹力。
speed：速度。
corner：角度传感器数据。
opening：是否为开门阶段。
closing：是否为关门阶段。
label：实验的标签类别（14 到 21 之间）。

### **模型结构**

使用了 CNN+LSTM 的混合模型，其中：

卷积神经网络（CNN）：负责从传感器数据中提取局部特征，通过卷积层和池化层减少时间维度，提取空间特征。
长短期记忆网络（LSTM）：捕捉时间序列中的长依赖关系，帮助模型理解数据的时间动态。
全连接层（FC）：用于将 LSTM 的输出映射到 8 个类别进行分类。
模型细节：
卷积层：1 层 Conv1d，卷积核数量为 128，核大小为 5，后接 ReLU 激活和 MaxPooling。
LSTM 层：双向 LSTM，3 层，隐藏层单元为 256，能够捕捉双向的时间序列依赖。
正则化：
使用了 Dropout（概率为 0.5）以防止过拟合。
使用了 L2 正则化（权重衰减值为 1e-4）防止模型过度拟合训练数据。

### **模型训练与评估**

训练过程使用 5 折交叉验证，并记录每次训练和测试的损失、准确率等评估指标。

超参数设置：
学习率：0.001
批量大小：32
训练轮次：20
L2 正则化：1e-4
Dropout：0.5
类别权重：对类别不平衡问题进行了加权处理，给少数类分配了较高的权重，具体权重配置如下：
class_weights = torch.tensor([3.0, 1.0, 1.0, 1.0, 2.0, 0.5, 3.0, 1.0]).to(device)

### **训练结果**

最新一次训练（Fold 5）的分类报告如下：
Fold experiment_split_fold_5 Classification Report:
              precision    recall  f1-score   support

     Class 0       0.65      0.54      0.59        24
     Class 1       0.87      0.95      0.91        21
     Class 2       0.89      0.74      0.81        23
     Class 3       0.65      0.48      0.55        27
     Class 4       0.41      0.50      0.45        28
     Class 5       0.97      1.00      0.98        28
     Class 6       0.17      0.35      0.23        34
     Class 7       0.67      0.39      0.49        77

    accuracy                           0.56       262
   macro avg       0.66      0.62      0.63       262
weighted avg       0.64      0.56      0.58       262

### 可视化结果

在训练过程中，脚本会自动生成以下图表，帮助评估模型的性能：

1. 损失和准确率曲线

- 在 `results/` 目录中，有每个折对应的损失和准确率曲线图（如 `fold_1_metrics.png`）。
- **损失曲线**：展示训练和测试的损失随时间的变化情况，用于判断模型是否收敛，以及是否存在过拟合。
- **准确率曲线**：展示训练和测试的准确率随时间的变化情况，帮助评估模型在训练集和测试集上的表现差异。

2. 混淆矩阵

- 混淆矩阵图（如 `fold_1_confusion_matrix.png`）展示了每个类别的分类结果，帮助分析模型在不同类别上的表现。
- 对角线上的值代表正确分类的样本数，非对角线的值表示模型的错误分类情况。通过观察混淆矩阵，可以发现哪些类别容易被混淆，哪些类别的表现较好。

### 运行项目

data_processing.py是将opening和closing合并到1个文件里，不需要运行

数据预处理：
python data_preparation.py

模型训练+结果展示：
python model_training.py
训练结果和模型文件将分别保存到 results/ 和 models/ 目录。

模型训练后，可以查看生成的分类报告和混淆矩阵。相关的图像（损失曲线、准确率曲线）和混淆矩阵将保存到 results/ 目录，模型参数将保存到 models/ 目录。